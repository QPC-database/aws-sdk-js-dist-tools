window.AWS.S3=window.AWS.Service.defineService("s3",["2006-03-01"],{initialize:function e(t){window.AWS.Service.prototype.initialize.call(this,t);this.setEndpoint((t||{}).endpoint,t)},setupRequestListeners:function t(e){e.addListener("build",this.addContentType);e.addListener("build",this.populateURI);e.addListener("build",this.computeContentMd5);e.removeListener("validate",window.AWS.EventListeners.Core.VALIDATE_REGION);e.addListener("extractError",this.extractError);e.addListener("extractData",this.extractData)},populateURI:function n(e){var t=e.httpRequest;var n=e.params.Bucket;if(n){if(!e.service.pathStyleBucketName(n)){t.endpoint.host=t.endpoint.hostname=n+"."+t.endpoint.hostname;t.virtualHostedBucket=n;t.path=t.path.replace(new RegExp("^/"+n),"");if(t.path[0]!=="/"){t.path="/"+t.path}}}},addContentType:function i(e){var t=e.httpRequest;if(!t.headers["Content-Type"]){t.headers["Content-Type"]="application/octet-stream"}if(window.AWS.util.isBrowser()&&navigator.userAgent.match(/Firefox/)){if(!t.headers["Content-Type"].match(/;/)){var n="; charset=UTF-8";t.headers["Content-Type"]+=n}}},computableChecksumOperations:{putBucketCors:true,putBucketLifecycle:true,putBucketTagging:true,deleteObjects:true},willComputeChecksums:function r(e){if(this.computableChecksumOperations[e.operation])return true;if(!this.config.computeChecksums)return false;if(!Buffer.isBuffer(e.httpRequest.body)&&typeof e.httpRequest.body!=="string"){return false}var t=e.service.api.operations[e.operation].input.members;if(t.ContentMD5&&!e.params.ContentMD5)return true},computeContentMd5:function o(e){if(e.service.willComputeChecksums(e)){var t=window.AWS.util.crypto.md5(e.httpRequest.body,"base64");e.httpRequest.headers["Content-MD5"]=t}},pathStyleBucketName:function a(e){if(this.config.s3ForcePathStyle)return true;if(this.dnsCompatibleBucketName(e)){return this.config.sslEnabled&&e.match(/\./)?true:false}else{return true}},dnsCompatibleBucketName:function s(e){var t=e;var n=new RegExp(/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/);var i=new RegExp(/(\d+\.){3}\d+/);var r=new RegExp(/\.\./);return t.match(n)&&!t.match(i)&&!t.match(r)?true:false},escapePathParam:function u(e){return window.AWS.util.uriEscapePath(String(e))},successfulResponse:function p(e){var t=e.request;var n=e.httpResponse;if(t.operation==="completeMultipartUpload"&&n.body.toString().match("<Error>"))return false;else return n.statusCode<300},retryableError:function d(e,t){if(t.operation=="completeMultipartUpload"&&e.statusCode===200){return true}else{var n=window.AWS.Service.prototype.retryableError;return n.call(this,e,t)}},extractData:function c(e){var t=e.request;if(t.operation==="getBucketLocation"){var n=e.httpResponse.body.toString().match(/>(.+)<\/Location/);if(n){delete e.data["_"];e.data.LocationConstraint=n[1]}}},extractError:function h(e){var t={304:"NotModified",403:"Forbidden",400:"BadRequest",404:"NotFound"};var n=e.httpResponse.statusCode;var i=e.httpResponse.body;if(t[n]&&i.length===0){e.error=window.AWS.util.error(new Error,{code:t[e.httpResponse.statusCode],message:null})}else{var r=new window.AWS.XML.Parser({}).parse(i.toString());e.error=window.AWS.util.error(new Error,{code:r.Code||n,message:r.Message||null})}},setEndpoint:function l(e){if(e){this.endpoint=new window.AWS.Endpoint(e,this.config)}else if(this.config.region&&this.config.region!=="us-east-1"){var t="s3-"+this.config.region+".amazonaws.com";this.endpoint=new window.AWS.Endpoint(t)}else{this.endpoint=new window.AWS.Endpoint(this.api.globalEndpoint,this.config)}},getSignedUrl:function f(e,t,n){var i=t.Expires||900;delete t.Expires;var r=require("url");var o=["validate","build","sign"];var a=this.makeRequest(e,t);var s="presigned-expires";function u(){delete a.httpRequest.headers["User-Agent"];delete a.httpRequest.headers["X-Amz-User-Agent"];a.httpRequest.headers[s]=parseInt(window.AWS.util.date.unixTimestamp()+i,10).toString()}function p(){var e={};window.AWS.util.each(a.httpRequest.headers,function(t,n){if(t===s)t="Expires";e[t]=n});delete a.httpRequest.headers[s];var t=e["Authorization"].split(":");delete e["Authorization"];delete e["Host"];e["AWSAccessKeyId"]=t[0].split(" ")[1];e["Signature"]=t[1];var n=a.httpRequest.endpoint;var i=r.parse(a.httpRequest.path);var o=window.AWS.util.queryParamsToString(e);n.pathname=i.pathname;n.search=!i.search?o:i.search+"&"+o}a.on("build",u);a.on("sign",p);a.removeListener("build",this.addContentType);if(!t.Body){a.removeListener("build",this.computeContentMd5)}if(n){a.emitEvents(o,new window.AWS.Response(a),function(e){if(e)n(e,null);else n(null,r.format(a.httpRequest.endpoint))})}else{window.AWS.util.arrayEach(o,function(e){a.emitEvent(e,[a])});return r.format(a.httpRequest.endpoint)}}});window.AWS.S3.prototype.createBucket=function m(e,t){if(!e)e={};var n=this.endpoint.hostname;if(n!=this.api.globalEndpoint&&!e.CreateBucketConfiguration){e.CreateBucketConfiguration={LocationConstraint:this.config.region}}return this.makeRequest("createBucket",e,t)};