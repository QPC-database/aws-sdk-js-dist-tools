window.AWS.S3=window.AWS.Service.defineService("s3");window.AWS.util.update(window.AWS.S3.prototype,{initialize:function e(t){window.AWS.Service.prototype.initialize.call(this,t);this.setEndpoint((t||{}).endpoint,t)},setupRequestListeners:function t(e){e.addListener("build",this.addContentType);e.addListener("build",this.populateURI);e.addListener("build",this.computeContentMd5);e.addListener("build",this.computeSha256);e.removeListener("validate",window.AWS.EventListeners.Core.VALIDATE_REGION);e.addListener("extractError",this.extractError);e.addListener("extractData",this.extractData);e.addListener("beforePresign",this.prepareSignedUrl)},populateURI:function n(e){var t=e.httpRequest;var n=e.params.Bucket;if(n){if(!e.service.pathStyleBucketName(n)){t.endpoint.hostname=n+"."+t.endpoint.hostname;var i=t.endpoint.port;if(i!==80&&i!==443){t.endpoint.host=t.endpoint.hostname+":"+t.endpoint.port}else{t.endpoint.host=t.endpoint.hostname}t.virtualHostedBucket=n;t.path=t.path.replace(new RegExp("/"+n),"");if(t.path[0]!=="/"){t.path="/"+t.path}}}},addContentType:function i(e){var t=e.httpRequest;if(!t.headers["Content-Type"]){t.headers["Content-Type"]="application/octet-stream"}var n=t.headers["Content-Type"];if(window.AWS.util.isBrowser()){if(typeof t.body==="string"&&!n.match(/;\s*charset=/)){var i="; charset=UTF-8";t.headers["Content-Type"]+=i}else{var r=function(e,t,n){return t+n.toUpperCase()};t.headers["Content-Type"]=n.replace(/(;\s*charset=)(.+)$/,r)}}},computableChecksumOperations:{putBucketCors:true,putBucketLifecycle:true,putBucketTagging:true,deleteObjects:true},willComputeChecksums:function r(e){if(this.computableChecksumOperations[e.operation])return true;if(!this.config.computeChecksums)return false;if(!window.AWS.util.Buffer.isBuffer(e.httpRequest.body)&&typeof e.httpRequest.body!=="string"){return false}var t=e.service.api.operations[e.operation].input.members;if(e.service.getSignerClass(e)===window.AWS.Signers.V4){if(t.ContentMD5&&!t.ContentMD5.required)return false}if(t.ContentMD5&&!e.params.ContentMD5)return true},computeContentMd5:function o(e){if(e.service.willComputeChecksums(e)){var t=window.AWS.util.crypto.md5(e.httpRequest.body,"base64");e.httpRequest.headers["Content-MD5"]=t}},computeSha256:function s(e){if(e.service.getSignerClass(e)===window.AWS.Signers.V4){e.httpRequest.headers["X-Amz-Content-Sha256"]=window.AWS.util.crypto.sha256(e.httpRequest.body||"","hex")}},pathStyleBucketName:function a(e){if(this.config.s3ForcePathStyle)return true;if(this.dnsCompatibleBucketName(e)){return this.config.sslEnabled&&e.match(/\./)?true:false}else{return true}},dnsCompatibleBucketName:function u(e){var t=e;var n=new RegExp(/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/);var i=new RegExp(/(\d+\.){3}\d+/);var r=new RegExp(/\.\./);return t.match(n)&&!t.match(i)&&!t.match(r)?true:false},escapePathParam:function p(e){return window.AWS.util.uriEscapePath(String(e))},successfulResponse:function d(e){var t=e.request;var n=e.httpResponse;if(t.operation==="completeMultipartUpload"&&n.body.toString().match("<Error>"))return false;else return n.statusCode<300},retryableError:function c(e,t){if(t.operation==="completeMultipartUpload"&&e.statusCode===200){return true}else{var n=window.AWS.Service.prototype.retryableError;return n.call(this,e,t)}},extractData:function h(e){var t=e.request;if(t.operation==="getBucketLocation"){var n=e.httpResponse.body.toString().match(/>(.+)<\/Location/);if(n){delete e.data["_"];e.data.LocationConstraint=n[1]}}},extractError:function l(e){var t={304:"NotModified",403:"Forbidden",400:"BadRequest",404:"NotFound"};var n=e.httpResponse.statusCode;var i=e.httpResponse.body;if(t[n]&&i.length===0){e.error=window.AWS.util.error(new Error,{code:t[e.httpResponse.statusCode],message:null})}else{var r=new window.AWS.XML.Parser({}).parse(i.toString());e.error=window.AWS.util.error(new Error,{code:r.Code||n,message:r.Message||null})}},setEndpoint:function f(e){if(e){this.endpoint=new window.AWS.Endpoint(e,this.config)}else if(this.config.region&&this.config.region!=="us-east-1"){var t="-";if(this.isRegionV4())t=".";var n="s3"+t+this.config.region+this.endpointSuffix();this.endpoint=new window.AWS.Endpoint(n)}else{this.endpoint=new window.AWS.Endpoint(this.api.globalEndpoint,this.config)}},getSignedUrl:function w(e,t,n){t=window.AWS.util.copy(t||{});var i=t.Expires||900;delete t.Expires;var r=this.makeRequest(e,t);return r.presign(i,n)},prepareSignedUrl:function m(e){e.removeListener("build",e.service.addContentType);if(!e.params.Body){e.removeListener("build",e.service.computeContentMd5);e.removeListener("build",e.service.computeSha256)}},createBucket:function g(e,t){if(!e)e={};var n=this.endpoint.hostname;if(n!==this.api.globalEndpoint&&!e.CreateBucketConfiguration){e.CreateBucketConfiguration={LocationConstraint:this.config.region}}return this.makeRequest("createBucket",e,t)}});