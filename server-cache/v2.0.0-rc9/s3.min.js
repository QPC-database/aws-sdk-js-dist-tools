window.AWS.S3=window.AWS.Service.defineService("s3",["2006-03-01"],{initialize:function e(t){window.AWS.Service.prototype.initialize.call(this,t);this.setEndpoint((t||{}).endpoint,t)},setupRequestListeners:function t(e){e.addListener("build",this.addContentType);e.addListener("build",this.populateURI);e.addListener("build",this.computeContentMd5);e.addListener("build",this.computeSha256);e.removeListener("validate",window.AWS.EventListeners.Core.VALIDATE_REGION);e.addListener("extractError",this.extractError);e.addListener("extractData",this.extractData)},populateURI:function i(e){var t=e.httpRequest;var i=e.params.Bucket;if(i){if(!e.service.pathStyleBucketName(i)){t.endpoint.host=t.endpoint.hostname=i+"."+t.endpoint.hostname;t.virtualHostedBucket=i;t.path=t.path.replace(new RegExp("^/"+i),"");if(t.path[0]!=="/"){t.path="/"+t.path}}}},addContentType:function n(e){var t=e.httpRequest;if(!t.headers["Content-Type"]){t.headers["Content-Type"]="application/octet-stream"}if(window.AWS.util.isBrowser()&&navigator.userAgent.match(/Firefox/)){if(!t.headers["Content-Type"].match(/;/)){var i="; charset=UTF-8";t.headers["Content-Type"]+=i}}},computableChecksumOperations:{putBucketCors:true,putBucketLifecycle:true,putBucketTagging:true,deleteObjects:true},willComputeChecksums:function r(e){if(this.computableChecksumOperations[e.operation])return true;if(!this.config.computeChecksums)return false;if(!window.AWS.util.Buffer.isBuffer(e.httpRequest.body)&&typeof e.httpRequest.body!=="string"){return false}var t=e.service.api.operations[e.operation].input.members;if(e.service.getSignerClass(e)===window.AWS.Signers.V4){if(t.ContentMD5&&!t.ContentMD5.required)return false}if(t.ContentMD5&&!e.params.ContentMD5)return true},computeContentMd5:function o(e){if(e.service.willComputeChecksums(e)){var t=window.AWS.util.crypto.md5(e.httpRequest.body,"base64");e.httpRequest.headers["Content-MD5"]=t}},computeSha256:function s(e){if(e.service.getSignerClass(e)===window.AWS.Signers.V4){e.httpRequest.headers["X-Amz-Content-Sha256"]=window.AWS.util.crypto.sha256(e.httpRequest.body||"","hex")}},pathStyleBucketName:function a(e){if(this.config.s3ForcePathStyle)return true;if(this.dnsCompatibleBucketName(e)){return this.config.sslEnabled&&e.match(/\./)?true:false}else{return true}},dnsCompatibleBucketName:function u(e){var t=e;var i=new RegExp(/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/);var n=new RegExp(/(\d+\.){3}\d+/);var r=new RegExp(/\.\./);return t.match(i)&&!t.match(n)&&!t.match(r)?true:false},escapePathParam:function d(e){return window.AWS.util.uriEscapePath(String(e))},successfulResponse:function p(e){var t=e.request;var i=e.httpResponse;if(t.operation==="completeMultipartUpload"&&i.body.toString().match("<Error>"))return false;else return i.statusCode<300},retryableError:function c(e,t){if(t.operation=="completeMultipartUpload"&&e.statusCode===200){return true}else{var i=window.AWS.Service.prototype.retryableError;return i.call(this,e,t)}},extractData:function h(e){var t=e.request;if(t.operation==="getBucketLocation"){var i=e.httpResponse.body.toString().match(/>(.+)<\/Location/);if(i){delete e.data["_"];e.data.LocationConstraint=i[1]}}},extractError:function l(e){var t={304:"NotModified",403:"Forbidden",400:"BadRequest",404:"NotFound"};var i=e.httpResponse.statusCode;var n=e.httpResponse.body;if(t[i]&&n.length===0){e.error=window.AWS.util.error(new Error,{code:t[e.httpResponse.statusCode],message:null})}else{var r=new window.AWS.XML.Parser({}).parse(n.toString());e.error=window.AWS.util.error(new Error,{code:r.Code||i,message:r.Message||null})}},setEndpoint:function f(e){if(e){this.endpoint=new window.AWS.Endpoint(e,this.config)}else if(this.config.region&&this.config.region!=="us-east-1"){var t="-";if(this.isRegionV4())t=".";var i="s3"+t+this.config.region+this.endpointSuffix();this.endpoint=new window.AWS.Endpoint(i)}else{this.endpoint=new window.AWS.Endpoint(this.api.globalEndpoint,this.config)}},getSignedUrl:function w(e,t,i){t=t||{};var n=t.Expires||900;delete t.Expires;var r=["validate","build","sign"];var o=this.makeRequest(e,t);var s="presigned-expires";function a(){delete o.httpRequest.headers["User-Agent"];delete o.httpRequest.headers["X-Amz-User-Agent"];if(o.service.getSignerClass()===window.AWS.Signers.V4){if(n>604800){var e="getSignedUrl() does not support expiry time greater "+"than a week with SigV4 signing.";throw window.AWS.util.error(new Error,{code:"InvalidExpiryTime",message:e,retryable:false})}o.httpRequest.headers[s]=n}else{o.httpRequest.headers[s]=parseInt(window.AWS.util.date.unixTimestamp()+n,10).toString()}}function u(){var e={};window.AWS.util.each(o.httpRequest.headers,function(t,i){if(t===s)t="Expires";e[t]=i});delete o.httpRequest.headers[s];var t=e["Authorization"].split(" ");if(t[0]==="window.AWS"){t=t[1].split(":");e["AWSAccessKeyId"]=t[0];e["Signature"]=t[1]}else if(t[0]==="AWS4-HMAC-SHA256"){t.shift();var i=t.join(" ");var n=i.match(/Signature=(.*?)(?:,|\s|\r?\n|$)/)[1];e["X-Amz-Signature"]=n;delete e["Expires"]}delete e["Authorization"];delete e["Host"];var r=o.httpRequest.endpoint;var a=window.AWS.util.urlParse(o.httpRequest.path);var u=window.AWS.util.queryParamsToString(e);r.pathname=a.pathname;r.search=!a.search?u:a.search+"&"+u}o.on("build",a);o.on("sign",u);o.removeListener("build",this.addContentType);if(!t.Body){o.removeListener("build",this.computeContentMd5);o.removeListener("build",this.computeSha256)}if(i){o.emitEvents(r,new window.AWS.Response(o),function(e){if(e)i(e,null);else i(null,window.AWS.util.urlFormat(o.httpRequest.endpoint))})}else{window.AWS.util.arrayEach(r,function(e){o.emitEvent(e,[o])});return window.AWS.util.urlFormat(o.httpRequest.endpoint)}}});window.AWS.S3.prototype.createBucket=function m(e,t){if(!e)e={};var i=this.endpoint.hostname;if(i!=this.api.globalEndpoint&&!e.CreateBucketConfiguration){e.CreateBucketConfiguration={LocationConstraint:this.config.region}}return this.makeRequest("createBucket",e,t)};