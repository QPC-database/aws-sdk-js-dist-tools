AWS.EC2=AWS.Service.defineService("ec2");AWS.util.update(AWS.EC2.prototype,{setupRequestListeners:function r(e){e.removeListener("extractError",AWS.EventListeners.Query.EXTRACT_ERROR);e.addListener("extractError",this.extractError);if(e.operation==="copySnapshot"){e.onAsync("validate",this.buildCopySnapshotPresignedUrl)}},buildCopySnapshotPresignedUrl:function e(r,o){if(r.params.PresignedUrl||r._subRequest){return o()}r.params=AWS.util.copy(r.params);r.params.DestinationRegion=r.service.config.region;var s=AWS.util.copy(r.service.config);delete s.endpoint;s.region=r.params.SourceRegion;s.signatureVersion="v4";var t=new r.service.constructor(s);var i=t[r.operation](r.params);i._subRequest=true;i.presign(function(e,s){if(e)o(e);else{r.params.PresignedUrl=s;o()}})},extractError:function o(r){var e=r.httpResponse;var o=(new AWS.XML.Parser).parse(e.body.toString()||"");if(o.Errors)r.error=AWS.util.error(new Error,{code:o.Errors.Error.Code,message:o.Errors.Error.Message});else r.error=AWS.util.error(new Error,{code:e.statusCode,message:null})}});