window.AWS.Glacier=window.AWS.Service.defineService("glacier",["2012-06-01"],{setupRequestListeners:function e(a){a.on("validate",this.validateAccountId);a.on("build",this.addGlacierApiVersion);a.on("build",this.addTreeHashHeaders)},validateAccountId:function a(e){if(e.params.accountId!==undefined)return;e.params=window.AWS.util.copy(e.params);e.params.accountId="-"},addGlacierApiVersion:function i(e){var a=e.service.api.apiVersion;e.httpRequest.headers["x-amz-glacier-version"]=a},addTreeHashHeaders:function r(e){if(e.params.body===undefined)return;var a=e.service.computeChecksums(e.params.body);e.httpRequest.headers["x-amz-content-sha256"]=a.linearHash;if(!e.httpRequest.headers["x-amz-sha256-tree-hash"]){e.httpRequest.headers["x-amz-sha256-tree-hash"]=a.treeHash}}});window.AWS.util.update(window.AWS.Glacier.prototype,{computeChecksums:function t(e){if(!(e instanceof Buffer))e=new Buffer(e);var a=1024*1024;var i=[];var r=window.AWS.util.crypto.createHash("sha256");for(var t=0;t<e.length;t+=a){var s=e.slice(t,Math.min(t+a,e.length));r.update(s);i.push(window.AWS.util.crypto.sha256(s))}return{linearHash:r.digest("hex"),treeHash:this.buildHashTree(i)}},buildHashTree:function s(e){while(e.length>1){var a=[];for(var i=0;i<e.length;i+=2){if(e[i+1]){var r=new Buffer(64);r.write(e[i],0,32,"binary");r.write(e[i+1],32,32,"binary");a.push(window.AWS.util.crypto.sha256(r))}else{a.push(e[i])}}e=a}return window.AWS.util.crypto.toHex(e[0])}});